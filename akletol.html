<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Contacts Pro</title>

<style>
 /* ===================== LIVE BACKGROUND ===================== */
 body::before {
   content: "";
   position: fixed;
   inset: 0;
   z-index: -3;
   background: linear-gradient(120deg, #2563eb, #7c3aed, #06b6d4, #22c55e);
   background-size: 300% 300%;
   animation: bgFlow 18s ease infinite;
 }

 body::after {
   content: "";
   position: fixed;
   inset: 0;
   z-index: -2;
   backdrop-filter: blur(70px);
   -webkit-backdrop-filter: blur(70px);
 }

 /* ===================== THEME ===================== */
 :root {
   --card: rgba(255, 255, 255, .8);
   --text: #0f172a;
   --primary: #2563eb;
   --border: rgba(0, 0, 0, .08);
   --input-bg: rgba(255, 255, 255, 0.9);
 }

 .dark {
   --card: rgba(17, 24, 39, .75);
   --text: #f8fafc;
   --primary: #38bdf8;
   --border: rgba(255, 255, 255, .1);
   --input-bg: rgba(17, 24, 39, 0.9);
 }

 /* ===================== BASE ===================== */
 * { box-sizing: border-box; }
 body {
   margin: 0;
   font-family: system-ui, -apple-system, sans-serif;
   color: var(--text);
   transition: color .4s;
 }

 /* ===================== HEADER ===================== */
 header {
   background: linear-gradient(135deg, var(--primary), #7c3aed);
   padding: 15px;
   color: #fff;
   border-radius: 0 0 28px 28px;
   box-shadow: 0 20px 40px rgba(0, 0, 0, .25);
   animation: slideDown .6s ease;
 }

 header h1 {
   margin: 0 0 15px 0;
   font-size: 22px;
   text-align: center;
   display: flex;
   justify-content: center;
   align-items: center;
   gap: 10px;
 }

 /* ===================== CONTROLS ===================== */
 .controls {
   display: flex;
   gap: 8px;
   margin-bottom: 10px;
 }
 .controls input {
   flex: 1;
   padding: 12px;
   border: none;
   border-radius: 14px;
   font-size: 16px;
   background: rgba(255,255,255,0.25);
   color: #fff;
 }
 .controls input::placeholder { color: rgba(255,255,255,0.7); }
 
 .btn-icon {
   width: 44px;
   border: none;
   border-radius: 14px;
   font-size: 20px;
   cursor: pointer;
   background: rgba(255,255,255,0.25);
   color: white;
   display: grid;
   place-items: center;
   transition: transform 0.2s;
 }
 .btn-icon:active { transform: scale(0.9); }

 .search-box input {
   width: 100%;
   padding: 14px;
   border: none;
   border-radius: 14px;
   outline: none;
   background: var(--input-bg);
   color: var(--text);
   box-shadow: 0 4px 15px rgba(0,0,0,0.1);
   font-size: 16px;
 }

 /* ===================== MAIN ===================== */
 main {
   max-width: 900px;
   margin: auto;
   padding: 20px 15px 80px 15px;
 }

 /* ===================== CARDS ===================== */
 .card {
   background: var(--card);
   backdrop-filter: blur(20px);
   -webkit-backdrop-filter: blur(20px);
   border-radius: 24px;
   box-shadow: 0 20px 40px rgba(0, 0, 0, .1);
   padding: 20px;
   margin-bottom: 25px;
   animation: fadeUp .6s ease;
 }

 .card h3 {
   margin-top: 0;
   opacity: 0.8;
   font-size: 18px;
   margin-bottom: 15px;
 }

 .add-row {
   display: grid;
   gap: 12px;
 }
 .add-row input {
   padding: 14px;
   border-radius: 12px;
   border: 1px solid var(--border);
   background: var(--input-bg);
   color: var(--text);
   font-size: 16px;
 }
 .save-btn {
   background: var(--primary);
   color: #fff;
   border: none;
   padding: 14px;
   border-radius: 12px;
   font-weight: bold;
   font-size: 16px;
   cursor: pointer;
   box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
 }

 /* ===================== LIST ===================== */
 .list-header {
   display: grid;
   grid-template-columns: 1.5fr 1.5fr 1fr;
   padding: 0 10px 10px 10px;
   font-weight: 700;
   opacity: 0.6;
   font-size: 12px;
   letter-spacing: 1px;
   text-transform: uppercase;
 }

 .contact-row {
   display: grid;
   grid-template-columns: 1.5fr 1.5fr 1fr;
   align-items: center;
   padding: 15px 10px;
   border-top: 1px solid var(--border);
   animation: rowIn .3s ease;
 }
 .contact-row:first-child { border-top: none; }

 .contact-phone {
   font-family: monospace;
   opacity: 0.8;
 }

 .actions { display: flex; justify-content: flex-end; gap: 8px; }
 .action-btn {
   background: none;
   border: none;
   font-size: 18px;
   cursor: pointer;
   padding: 5px;
   transition: transform 0.2s;
 }
 .action-btn:active { transform: scale(1.2); }
 .fav-active { color: gold; filter: drop-shadow(0 0 2px orange); }

 /* ===================== ANIMATIONS ===================== */
 @keyframes bgFlow { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
 @keyframes slideDown { from{transform:translateY(-20px);opacity:0} to{transform:translateY(0);opacity:1} }
 @keyframes fadeUp { from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1} }
 @keyframes rowIn { from{transform:translateX(-10px);opacity:0} to{transform:translateX(0);opacity:1} }

 /* Mobile Tweaks */
 @media(min-width: 600px) {
   .add-row { grid-template-columns: 1fr 1fr auto; }
   .list-header, .contact-row { grid-template-columns: 2fr 2fr 1fr; }
 }
</style>
</head>

<body>

<header>
  <h1>üì± Smart Contacts Pro</h1>
  
  <div class="controls">
    <input id="cmd" placeholder="Try: call papa | whatsapp yash">
    <button class="btn-icon" onclick="resetData()" title="Reset Data">‚Üª</button>
    <button class="btn-icon" onclick="toggleTheme()" title="Toggle Theme">üåó</button>
  </div>
  
  <div class="search-box">
    <input id="searchInput" placeholder="Search contact by name...">
  </div>
</header>

<main>

  <section class="card">
    <h3>Add New Contact</h3>
    <div class="add-row">
      <input id="newName" placeholder="Name">
      <input id="newPhone" type="tel" placeholder="Phone Number">
      <button class="save-btn" onclick="addNew()">Save</button>
    </div>
  </section>

  <section>
    <h3>‚≠ê Favorites</h3>
    <div id="favList" class="card" style="padding:10px 20px; min-height:50px"></div>
  </section>

  <section>
    <h3>üìã All Contacts</h3>
    <div class="card" style="padding: 10px 20px;">
      <div class="list-header">
        <span>Name</span>
        <span>Phone</span>
        <span style="text-align:right">Actions</span>
      </div>
      <div id="mainList"></div>
    </div>
  </section>

</main>

<script>
/* ===================== DATA ===================== */
const defaultContacts = [
  {name:"Papa",phone:"+918340127053", fav:true},
  {name:"Mama",phone:"+919934354816", fav:true},
  {name:"Yash",phone:"+916202696257", fav:false},
  {name:"Ankit Prasad",phone:"+917280931753", fav:false},
  {name:"Ashwanit",phone:"+917559161918", fav:false},
  {name:"Asif",phone:"+917667158191", fav:false},
  {name:"Aditya",phone:"+919304535471", fav:false},
  {name:"Avinash",phone:"+918709964961", fav:false},
  {name:"Ayush",phone:"+919835182822", fav:false},
  {name:"Bikash",phone:"+9195567850001", fav:false},
  {name:"Home",phone:"+919031916850", fav:false},
  {name:"Priyanka",phone:"+919798020515", fav:false},
  {name:"Rounak",phone:"+919955883454", fav:false},
  {name:"Suraj",phone:"+917739907729", fav:false}

  
  ];

// 1. Initialize State
let contacts = [];

function init() {
  const stored = localStorage.getItem("contacts_v2");
  if (stored) {
    contacts = JSON.parse(stored);
  }
  
  // FIX: If list is empty (or first run), force load defaults
  if (!contacts || contacts.length === 0) {
    console.log("No contacts found. Loading defaults...");
    contacts = JSON.parse(JSON.stringify(defaultContacts)); // Deep copy
    save();
  }
  
  render();
}

function save() {
  localStorage.setItem("contacts_v2", JSON.stringify(contacts));
}

function resetData() {
  if(confirm("Reset to default demo data?")) {
    contacts = JSON.parse(JSON.stringify(defaultContacts));
    save();
    render();
    document.getElementById('searchInput').value = '';
  }
}

/* ===================== RENDER LOGIC ===================== */
const mainList = document.getElementById("mainList");
const favList = document.getElementById("favList");

function render(filter = "") {
  mainList.innerHTML = "";
  favList.innerHTML = "";
  
  const term = filter.toLowerCase();
  let found = false;

  contacts.forEach((c, index) => {
    if (c.name.toLowerCase().includes(term)) {
      found = true;
      const rowHTML = createRow(c, index);
      mainList.innerHTML += rowHTML;
      if (c.fav) favList.innerHTML += rowHTML;
    }
  });

  if (!found) {
    mainList.innerHTML = `<div style="padding:20px; text-align:center; opacity:0.6">No contacts found</div>`;
  }
  if (favList.innerHTML === "") {
    favList.innerHTML = `<div style="padding:20px; text-align:center; opacity:0.6">No favorites yet</div>`;
  }
}

function createRow(c, i) {
  return `
    <div class="contact-row">
      <span>${c.name}</span>
      <span class="contact-phone">${c.phone}</span>
      <div class="actions">
        <button class="action-btn" onclick="call('${c.phone}')">üìû</button>
        <button class="action-btn" onclick="wa('${c.phone}')">üí¨</button>
        <button class="action-btn ${c.fav ? 'fav-active' : ''}" onclick="toggleFav(${i})">‚òÖ</button>
      </div>
    </div>
  `;
}

/* ===================== ACTIONS ===================== */
function addNew() {
  const n = document.getElementById("newName");
  const p = document.getElementById("newPhone");
  if(!n.value || !p.value) return alert("Please enter Name and Phone");
  
  contacts.unshift({name: n.value, phone: p.value, fav: false});
  save();
  render();
  n.value = ""; p.value = "";
}

function toggleFav(i) {
  contacts[i].fav = !contacts[i].fav;
  save();
  // We re-read search input to keep current view state
  render(document.getElementById("searchInput").value); 
}

function call(p) { location.href = "tel:" + p; }
function wa(p) { window.open("https://wa.me/" + p.replace(/\D/g,"")); }

/* ===================== LISTENERS ===================== */
// Search Listener
document.getElementById("searchInput").addEventListener("input", (e) => {
  render(e.target.value);
});

// Command Listener
document.getElementById("cmd").addEventListener("keydown", (e) => {
  if(e.key !== "Enter") return;
  const val = e.target.value.toLowerCase();
  
  // Simple command parser
  if(val.includes("call")) {
    const name = val.replace("call", "").trim();
    const c = contacts.find(x => x.name.toLowerCase().includes(name));
    if(c) call(c.phone); else alert("Contact not found");
  } 
  else if(val.includes("whatsapp")) {
    const name = val.replace("whatsapp", "").trim();
    const c = contacts.find(x => x.name.toLowerCase().includes(name));
    if(c) wa(c.phone); else alert("Contact not found");
  }
  e.target.value = "";
});

// Theme Toggle
if(localStorage.theme === 'dark') document.body.classList.add('dark');
function toggleTheme() {
  document.body.classList.toggle('dark');
  localStorage.theme = document.body.classList.contains('dark') ? 'dark' : 'light';
}

// Start
init();
</script>

</body>
</html>
